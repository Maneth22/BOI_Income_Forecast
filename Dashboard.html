<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
          integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
    <title>BOI Analytics</title>
    <style>
        .nav-text {
            font-weight: bold;
            font-family: 'Heebo', sans-serif;

        }

        div.card {
            box-shadow: 0 4px 8px 0 rgba(41, 163, 163, 0.5), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            width: 100%;

        }

        div.header {
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            font-size: 40px;
        }

        div.container {
            padding: 10px;
        }

        .sidenav {
            height: 100%;
            width: 0;
            position: fixed;
            z-index: 1;
            top: 0;
            left: 0;
            background-color: #5cd6d6;
            overflow-x: hidden;
            transition: 0.5s;
            padding-top: 60px;
        }

        .sidenav a {
            padding: 8px 8px 8px 32px;
            text-decoration: none;
            font-size: 25px;
            color: #000066;
            display: block;
            transition: 0.3s;
        }

        .sidenav a:hover {
            color: #f1f1f1;
        }

        .sidenav .closebtn {
            position: absolute;
            top: 0;
            right: 25px;
            font-size: 36px;
            margin-left: 50px;
        }

        #main {
            transition: margin-left .5s;
            padding: 16px;
        }

        body-main {
            text-align: center;
            justify-content: center;
            margin-left: 8%;
            display: table;
        }

        .body-graph {
            padding: 30px;
            width: 45%;
            height: auto;
        }

        .barplot {
            float: left;
            padding: 20px;
            width: 50%;
            background-color: #f1f1f1;
            height: 300px; /* only for demonstration, should be removed */
        }

        .currency {
            float: left;
            width: 50%;
            height: max-content; /* only for demonstration, should be removed */
            background: #ccc;
            padding: 20px;
        }

        /* Clear floats after the columns */
        section::after {
            content: "";
            display: table;
            clear: both;
        }

        /* Style the footer */
        footer {
            background-color: #5cd6d6;
            padding: 10px;
            text-align: center;
            color: white;
        }

        @media screen and (max-height: 450px) {
            .sidenav {
                padding-top: 15px;
            }

            .sidenav a {
                font-size: 12px;
            }
        }

    </style>
</head>
<body>
<nav class="navbar navbar-light bg-light">
    <div id="main">
        <a class="navbar-brand" href="#"><span style="cursor:pointer"
                                               onclick="openNav()">&#9776; BOI Dashboard</span></a>
    </div>


    <div id="mySidenav" class="sidenav">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <a href="#">About</a>
        <a href="#">Services</a>
        <a href="#">Clients</a>
        <a href="#">Contact</a>
    </div>

    <form class="form-inline">
        <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
        <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
    </form>
</nav>
<div class="container-fluid" style="display: flex; justify-content: center; margin: 0px">
    <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">

        <div class="carousel-inner">
            <div class="carousel-item active">
                <div id="chart0" class="d-block"></div>
            </div>
            <div class="carousel-item">
                <div id="chart1" class="d-block"></div>
            </div>
            <div class="carousel-item">
                <div id="chart2" class="d-block"></div>
            </div>
            <div class="carousel-item">
                <div id="chart3" class="d-block"></div>
            </div>
            <div class="carousel-item">
                <div id="chart4" class="d-block"></div>
            </div>
            <div class="carousel-item">
                <div id="chart5" class="d-block"></div>
            </div>
            <div class="carousel-item">
                <div id="chart6" class="d-block"></div>
            </div>
            <div class="carousel-item">
                <div id="chart7" class="d-block"></div>
            </div>
            <div class="carousel-item">
                <div id="chart8" class="d-block"></div>
            </div>
        </div>
        <button class="carousel-control-next" type="button" data-target="#carouselExampleControls" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
        </button>
        <button class="carousel-control-prev" type="button" data-target="#carouselExampleControls" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
        </button>

    </div>
</div>
<hr>
<div class="container">
    <div class="row">
        <div class="col" >
            <div class="card" style="height: max-content;">
                <div id="chart9" class="d-block" ></div>
            </div>
        </div>
        <div class="col">
            <div class="row">
                <div class="col" style="padding-bottom: 30px">
                    <div class="card" >
                        <canvas id="barchrt" class="d-block" style="width: 600px"></canvas>
                    </div>
                </div>
                <div class="col">
                    <div class="card">
                        <p  style="padding: 20px; font-weight: bold;">The Most Profitable Sector is: <span id="PSText" style="color: #5cd6d6"></span></p>
                    </div>

                </div>
            </div>

        </div>
    </div>
</div>


<h1></h1>
<footer></footer>
<script>
    function openNav() {
        document.getElementById("mySidenav").style.width = "250px";
        document.getElementById("main").style.marginLeft = "250px";
    }

    function closeNav() {
        document.getElementById("mySidenav").style.width = "0";
        document.getElementById("main").style.marginLeft = "0";
    }
</script>
<script>

    $(document).ready(function () {


        $.ajax({
            url: "http://127.0.0.1:5000/forecast",
            type: "GET",
            dataType: "json",
            success: function (data) {
                console.log(data.data_array[0]);
                const food_plotting_data = data.data_array[0]
                plot_now(food_plotting_data, 'chart0', 'Food');

                const Textile_plotting_data = data.data_array[1]
                plot_now(Textile_plotting_data, 'chart1', 'Textile');

                const wood_plotting_data = data.data_array[2]
                plot_now(wood_plotting_data, 'chart2', 'Wood');

                const paper_plotting_data = data.data_array[3]
                plot_now(paper_plotting_data, 'chart3', 'Paper');

                const chemicals_plotting_data = data.data_array[4]
                plot_now(chemicals_plotting_data, 'chart4', 'Chemicals');

                const Mineral_plotting_data = data.data_array[5]
                plot_now(Mineral_plotting_data, 'chart5', 'Minerals');

                const Equipment_plotting_data = data.data_array[6]
                plot_now(Equipment_plotting_data, 'chart6', 'Equipment');

                const Manufactured_plotting_data = data.data_array[7]
                plot_now(Manufactured_plotting_data, 'chart7', 'Manufactured');

                const Services_plotting_data = data.data_array[8]
                plot_now(Services_plotting_data, 'chart8', 'services');

                const Currency = data.data_array[9]
                plt_currency(Currency, 'chart9', 'Mean Currency');

                barChart(data, barchrt)
                GetMostProfitable(data)

                // Handle the returned JSON data here
                console.log(data); // Log the data to the console

            },
            error: function (error) {
                console.log(error); // Log any errors to the console
            }

        });
    });

    function barChart(data, divId) {
        var xValues = ["Food, Beverages and Tobacco Products", "Textile, Wearing Apparel and Leather Products", "Wood and Wood Products", "Paper, Paper Products, Printing and Publishing"
            , "Chemicals, Petroleum, Coal, Rubber and Plastic Products", "Non-Metallic Mineral Products", "Fabricated Metal, Machinery and Transport Equipment", "Manufactured Products (Not Elsewhere Specified)",
            "Services and Infrastructure"];
        var dataArray = [];
        var sum = 0;
        const d = new Date();
        let year = d.getFullYear() + 1;
        const nextDate = year.toString() + '-12-31';
        for (let i = 0; i < data.data_array.length - 1; i++) {
            for (let j = 0; j < data.data_array[i].Forecast_data.values.length; j++) {
                var index = data.data_array[i].Forecast_data.index[j]

                if (index == nextDate) {
                    sum = data.data_array[i].Forecast_data.values[j];
                }
                ;

            }
            dataArray.push(sum)

        }
        ;
        var barColors = [
            'rgba(54, 162, 235, 0.6)',   // Blue
            'rgba(255, 99, 132, 0.6)',   // Red
            'rgba(255, 206, 86, 0.6)',   // Yellow
            'rgba(75, 192, 192, 0.6)',   // Teal
            'rgba(153, 102, 255, 0.6)',  // Purple
            'rgba(255, 159, 64, 0.6)',   // Orange
            'rgba(0, 128, 0, 0.6)',      // Green
            'rgba(255, 0, 255, 0.6)',    // Magenta
            'rgba(128, 128, 128, 0.6)'   // Gray
        ];
        console.log(dataArray)
        var yValues = dataArray;


        new Chart(divId, {
            type: "horizontalBar",
            data: {
                labels: xValues,
                datasets: [{
                    data: yValues,
                    backgroundColor: barColors

                }]
            },
            options: {
                legend: {display: false},
                title: {
                    display: true,
                    text: "Estimated Income Growth in Sectors For the Year " + year + "- $(Mn)"
                }
            }
        });
    }

    function coefficient_of_variation(df) {
        let sum = 0;
        try {
            const current_df = df;

            const fittedValues = current_df.Actual_data;
            for (let i = 0; i < fittedValues.values.length; i++) {
                sum += fittedValues.values[i];

            }
            const meanVal = sum / fittedValues.values.length;
            const sd = Math.sqrt(fittedValues.values.reduce((acc, val) => acc + Math.pow(val - meanVal, 2), 0) / fittedValues.values.length);
            const CV = (sd / meanVal) * 100;
            const roundedCV = Math.round(CV * 100) / 100;

            console.log(roundedCV);
            return roundedCV;
        } catch (error) {
            console.error("An error occurred:", error.message);
            return null;
        }
    }


    function plt_currency(data, container_id, d_title) {
        console.log(data);

        const forecastData = data.Forecast_data;
        const upBound = data.up_bound;
        const lowBound = data.low_bound;

        // Create traces for the plot


        const forecastTrace = {
            x: forecastData.index,
            y: forecastData.values,
            mode: 'lines',
            name: 'Forecast'
        };


        const fillBetweenBounds = {
            x: upBound.index.concat(lowBound.index.reverse()), // Combine upper and lower x values
            y: upBound.values.concat(lowBound.values.reverse()), // Combine upper and lower y values
            fill: 'toself', // Fill to itself to create a closed region
            fillcolor: 'rgba(26, 117, 255,0.2)', // Fill color (adjust as needed)
            line: {color: 'transparent'}, // Hide the line border of the filled region
            name: 'Bounds Area'
        };

        // Create the plot layout
        const layout = {
            title: "USD-LKR "+d_title+" (Rs)",
            xaxis: {title: 'Time'},
            yaxis: {title: 'Values'},
            showlegend: true
        };

        const plotting_data = [forecastTrace, fillBetweenBounds];

        Plotly.newPlot(container_id, plotting_data, layout);

    };

    function GetMostProfitable(data) {
        var sectorNames = ["Food, Beverages and Tobacco Products", "Textile, Wearing Apparel and Leather Products", "Wood and Wood Products", "Paper, Paper Products, Printing and Publishing"
            , "Chemicals, Petroleum, Coal, Rubber and Plastic Products", "Non-Metallic Mineral Products", "Fabricated Metal, Machinery and Transport Equipment", "Manufactured Products (Not Elsewhere Specified)",
            "Services and Infrastructure"];
        var meanValue = 0;
        var sum = 0;
        var highestMean = 0;
        var inte;
        var profitable_sector ;
        for (let i = 0; i < data.data_array.length - 1; i++) {
            sum = 0;
            for (let j = 0; j < data.data_array[i].Forecast_data.values.length; j++) {

                sum += data.data_array[i].Forecast_data.values[j];


            }
            meanValue = sum/data.data_array[i].Forecast_data.values.length
            if (highestMean< meanValue) {
                    highestMean = meanValue;
                    inte = i;
                }
            console.log(highestMean)


        }
        profitable_sector =sectorNames[inte];


        var paragraphElement = document.getElementById("PSText");
        if (paragraphElement) {
            paragraphElement.textContent =  profitable_sector;
        }
    }


    function plot_now(data, container_id, d_title) {

        const varience = coefficient_of_variation(data)

        const actualData = data.Actual_data;
        const forecastData = data.Forecast_data;
        const gapData = data.Gap_data;
        const upBound = data.up_bound;
        const lowBound = data.low_bound;
        console.log(data)

        // Create traces for the plot
        const actualTrace = {
            x: actualData.index,
            y: actualData.values,
            mode: 'lines',
            name: 'Actual'
        };

        const forecastTrace = {
            x: forecastData.index,
            y: forecastData.values,
            mode: 'lines',
            name: 'Forecast'
        };

        const gapTrace = {
            x: gapData.index,
            y: gapData.values,
            mode: 'lines',
            name: 'Gap'
        };

        const fillBetweenBounds = {
            x: upBound.index.concat(lowBound.index.reverse()), // Combine upper and lower x values
            y: upBound.values.concat(lowBound.values.reverse()), // Combine upper and lower y values
            fill: 'toself', // Fill to itself to create a closed region
            fillcolor: 'rgba(0,100,80,0.2)', // Fill color (adjust as needed)
            line: {color: 'transparent'}, // Hide the line border of the filled region
            name: 'Bounds Area'
        };

        // Create the plot layout
        const layout = {
            title: d_title + " Sector Income Growth" + "\n Coefficient Of Varience : " + varience,
            xaxis: {title: 'Time'},
            yaxis: {title: 'Values'},
            showlegend: true
        };

        const plotting_data = [actualTrace, forecastTrace, gapTrace, fillBetweenBounds];

        Plotly.newPlot(container_id, plotting_data, layout);

    };


</script>
<!-- Optional JavaScript; choose one of the two! -->

<!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Option 2: Separate Popper and Bootstrap JS -->
<!--
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>
-->
</body>
</html>